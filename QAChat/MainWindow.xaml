<Window x:Class="QAChat.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:QAChat"
        mc:Ignorable="d"
        Title="QAチャット" Height="450" Width="800">
    <Window.DataContext>
        <local:MainWindowViewModel/>
    </Window.DataContext>
    <Window.InputBindings>
        <KeyBinding Key="Enter" 
                Command="{Binding SendChatCommand}"
                CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}"                    
                />
        <KeyBinding Key="Escape" 
                Command="{Binding CloseCommand}"
                CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}"                    
                />
    </Window.InputBindings>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <StackPanel  Orientation="Vertical" Grid.Row="0" Margin="10,0,10,0">
            <!-- メニューバー -->
            <Menu Name="menu1" VerticalAlignment="Top" IsMainMenu="True" HorizontalAlignment="Right">
                <MenuItem Header="ログ" Command="{Binding LogWindowCommand}" />
                <MenuItem Header="設定" Command="{Binding SettingCommand}" 
                          IsEnabled="{Binding IsInternalProject}"/>
            </Menu>
        </StackPanel>

        <ListBox
            ItemsSource="{Binding ChatItems}"
            SelectedItem="{Binding SelectedItem}"
            Grid.Row="1"
            ScrollViewer.HorizontalScrollBarVisibility ="Auto"
        >
            
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="0,0,0,0" 
                                Width="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}, Path=Width }"
                              
                            >
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Text="{Binding Role}"
                            FontSize="8pt"
                            Grid.Row="0"/>
                        <Border
                           BorderBrush="Black" 
                           BorderThickness="1"  
                           Grid.Row="1"
                                   
                           Margin="0,0,30,0"
                               >
                            <TextBlock 
                                Text="{Binding ContentWithSources}"
                                FontSize="8pt"
                                MinHeight="30" 
                                TextWrapping="Wrap"
                                />
                        </Border>
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"></Setter>
                </Style>
            </ListBox.ItemContainerStyle>
        </ListBox>
        <TextBox Grid.Row="2" Text="{Binding InputText, UpdateSourceTrigger=PropertyChanged}" Margin="10,10,10,10" MinHeight="50"
                 AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                 >
            <TextBox.InputBindings>
                <KeyBinding Key="Enter" Command="{Binding SendChatCommand}"/>
                <KeyBinding Key="Escape" Command="{Binding CloseCommand}"/>
            </TextBox.InputBindings>
        </TextBox>
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="送信" 
                Command="{Binding SendChatCommand}" 
                CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}"                    
                Margin="10,10,10,10"/>
            <Button Content="クリア" Command="{Binding ClearChatCommand}" Margin="10,10,10,10"/>
            <Button Content="閉じる"
                Command="{Binding CloseCommand}"  
                CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}"                    
                Margin="10,10,10,10"/>
        </StackPanel>
    </Grid>
</Window>
